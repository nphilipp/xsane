SHELL = /bin/sh

VPATH = @srcdir@
srcdir = @srcdir@
top_srcdir = @top_srcdir@
top_builddir = ..

prefix = @prefix@
exec_prefix = @exec_prefix@
bindir = @bindir@
sbindir = @sbindir@
libexecdir = @libexecdir@
datadir = @datadir@
sysconfdir = @sysconfdir@
sharedstatedir = @sharedstatedir@
localstatedir = @localstatedir@
libdir = @libdir@
infodir = @infodir@
mandir = @mandir@
includedir = @includedir@
oldincludedir = /usr/include
configdir = ${sysconfdir}/sane.d
sanedatadir = ${datadir}/sane

MKDIR = $(top_srcdir)/mkinstalldirs
INSTALL = @INSTALL@
INSTALL_PROGRAM = @INSTALL_PROGRAM@
INSTALL_DATA = @INSTALL_DATA@

CC = @CC@
INCLUDES = -I. -I$(srcdir) -I$(top_builddir)/include -I$(top_srcdir)/include \
	@GTK_CFLAGS@ @INCLUDES@
DEFS = @DEFS@
CPPFLAGS = @CPPFLAGS@
CFLAGS = @CFLAGS@
LDFLAGS = @LDFLAGS@
LIBS = @LIBS@
GTK_LIBS = @GTK_LIBS@
GIMP_LIBS = @GIMP_LIBS@

LIBTOOL = ../libtool
MINST	= --mode=install
MLINK	= --mode=link
XSCAN	= @XSCAN@

COMPILE = $(CC) -c $(DEFS) $(INCLUDES) $(CPPFLAGS) $(CFLAGS)
LINK = $(CC) $(LDFLAGS) -o $@

@SET_MAKE@

BINPROGS = $(XSCAN)
PROGRAMS = $(BINPROGS)
LIBLIB = ../lib/liblib.a
LIBSANEI = ../sanei/libsanei.a

XSANE_OBJS = xsane.o xsane-preview.o xsane-preferences.o xsane-gtk.o xsane-save.o

.c.o:
	$(COMPILE) $<

all: $(PROGRAMS)

install: $(PROGRAMS)
	$(MKDIR) $(bindir) $(sbindir) $(datadir) $(sanedatadir)
	@for program in $(BINPROGS); do \
	  $(LIBTOOL) $(MINST) $(INSTALL_PROGRAM) $${program} \
	    $(bindir)/$${program}; \
	done
	$(INSTALL_DATA) $(srcdir)/xsane-style.rc $(sanedatadir)/xsane-style.rc
	$(INSTALL_DATA) $(srcdir)/xsane-logo.xpm $(sanedatadir)/xsane-logo.xpm

xsane: $(XSANE_OBJS) $(LIBSANEI) $(LIBLIB)
	@$(LIBTOOL) $(MLINK) $(LINK) $(XSANE_OBJS) $(LIBSANEI) \
	        $(LIBLIB) $(GIMP_LIBS) $(GTK_LIBS) $(LIBS)


clean:
	rm -f *.o *~ .*~ *.bak
	rm -rf .libs

distclean: clean
	rm -f Makefile $(PROGRAMS)

depend:
	makedepend $(INCLUDES) *.c

.PHONY: all install depend clean distclean
